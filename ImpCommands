Postgres
--------
for container login :: docker exec -it 512271de1e9a psql -U postgres
\dt :: to get all tables names.
mvnw -ls catalog-service spring-boot


Sequence generator
-----------------

DB ::
create sequence product_id_seq start with 1 increment by 50;
create sequence order_id_seq start with 1 increment by 50;
create sequence order_item_id_seq start with 1 increment by 50;

    id       bigint default nextval('order_id_seq') not null,

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "order_id_generator")
    @SequenceGenerator(name = "order_id_generator", sequenceName = "order_id_seq")
    private Long id;


    id       bigint default nextval('order_item_id_seq') not null,

    @Id
        @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "order_item_id_generator")
        @SequenceGenerator(name = "order_item_id_generator", sequenceName = "order_item_id_seq")
        private Long id;


DB Mappings
-------------

    @OneToMany(cascade = CascadeType.ALL, mappedBy = "order")
    private Set<OrderItemEntity> items;

    @ManyToOne(optional = false)
    @JoinColumn(name = "order_id")
    private OrderEntity order;


Entity field Validations
------------------------
@Column(nullable = false, unique = true,name = "created_at", nullable = false, updatable = false)
    @NotBlank(message = "Product code is required")
 @DecimalMin("0.1")

@Min(value = 1, message = "Min quantity must be 1")
  @Enumerated(EnumType.STRING)
    private OrderStatus status;

 @Valid :: This annotation ensures that all validations ( as above ) is imposed or not

----------------------
Exception Handling
--------
Internal service call with try-catch

{
    "detail": "Invalid Product code:P103A",
    "instance": "/api/orders",
    "status": 400,
    "title": "Invalid Order Creation Request",
    "type": "https://api.bookstore.com/errors/bad-request",
    "service": "order-service",
    "error_category": "Generic",
    "timestamp": "2025-12-23T13:05:13.648368700Z"
}

Internal service call without try-catch

{
    "detail": "404 Not Found: \"{\"detail\":\"Product with code P103A not found\",\"instance\":\"/api/products/P103A\",\"status\":404,\"title\":\"Product Not Found\",\"type\":\"https://api.bookstore.com/errors/not-found\",\"service\":\"catalog-service\",\"error_category\":\"Generic\",\"timestamp\":\"2025-12-23T13:12:06.165113700Z\"}\"",
    "instance": "/api/orders",
    "status": 500,
    "title": "Internal Server Error",
    "type": "https://api.bookstore.com/errors/server-error",
    "service": "order-service",
    "error_category": "Generic",
    "timestamp": "2025-12-23T13:12:06.182146Z"
}

When Optional is empty -> then orElseThrow will execute.

Product product = productServiceClient
                    .getProductByCode(item.code())
                    .orElseThrow(() -> new InvalidOrderException("Invalid Product code:" + item.code()));

Circuit Breaker

resilience4j.circuitbreaker.backends.catalog-service.sliding-window-size=6
resilience4j.circuitbreaker.backends.catalog-service.minimum-number-of-calls=4   what is the difference between above two properties

Calls 1-3: All fail → Circuit stays CLOSED (haven't reached minimum 4 calls yet)
Call 4: Fails → Now circuit breaker evaluates the failure rate from the last 4 calls
Calls 5-6: If these also fail and failure rate exceeds your threshold, circuit OPENS

